<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Générateur de films - Fullscreen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Montserrat', sans-serif;
      background: #000;
      color: #fff;
      overflow: hidden;
      cursor: url('https://raw.githubusercontent.com/astridkzn/incredibly-strange-films/main/images/open.png') 16 16, auto;
    }

    /* Fullscreen background */
    .background-section {
      position: fixed;
      inset: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-color: #000;
      z-index: -1;
      transition: background-image 0.4s ease-in-out;
    }

    /* Search bar */
    header {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 600px;
      z-index: 10;
    }

    #search {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      background: transparent;
      color: #fff;
      border: 2px solid #fff;
    }

    #search::placeholder { color: #ccc; }

    #suggestions {
      list-style: none;
      margin: 0;
      padding: 0;
      display: none;
      position: absolute;
      width: 100%;
      background: #000;
      border: 2px solid #fff;
      border-top: none;
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
    }

    #suggestions li {
      padding: 10px;
      cursor: pointer;
    }

    #suggestions li:hover {
      background: #222;
    }

    /* Infos */
    .info {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 900px;
      padding: 20px;
      z-index: 10;
    }

    .info h2 {
      font-size: 3em;
      margin: 0 0 10px;
    }

    .info p {
      font-size: 1.2em;
      margin: 5px 0;
    }

    .info button {
      margin-top: 10px;
      padding: 12px 20px;
      background: transparent;
      color: #fff;
      border: 2px solid #fff;
      cursor: pointer;
      font-size: 16px;
    }

    #warning {
      margin-top: 10px;
      font-weight: bold;
    }

    @media (max-width: 900px) {
      .info h2 { font-size: 2em; }
      .info p { font-size: 1em; }
      #search { font-size: 14px; padding: 10px; }
    }
  </style>
</head>

<body>

  <!-- Background -->
  <section class="background-section" id="background"></section>

  <!-- Search -->
  <header>
    <input type="text" id="search" placeholder="Rechercher un film…" />
    <ul id="suggestions"></ul>
  </header>

  <!-- Infos -->
  <section class="info">
    <h2 id="title"></h2>
    <p id="meta"></p>
    <p id="desc"></p>
    <button onclick="pickMovie()">Relancer</button>
    <p id="warning"></p>
  </section>

  <script>
    let movies = [];
    let relaunchCount = 0;

    const messages = ["Eh", "Abuse-pas", "Ehhhhh", "C'EST PAS INFINI"];
    const searchInput = document.getElementById("search");
    const suggestionsEl = document.getElementById("suggestions");
    const bgEl = document.getElementById("background");

    /* Fetch Google Sheets via OpenSheet */
    fetch("https://opensheet.elk.sh/19MCPj6cMFNGhO_Q0Cj8DxnJ9YMevFzrKLOXssBl6JW4/base")
      .then(res => res.json())
      .then(data => {
        movies = data;
        if (movies.length) pickMovie();
      });

    /* Random movie */
    function pickMovie() {
      if (!movies.length) return;
      const movie = movies[Math.floor(Math.random() * movies.length)];
      displayMovie(movie);
      handleRelaunchCount();
    }

    /* Movie by title */
    function pickMovieByTitle(title) {
      const movie = movies.find(m => m.title === title);
      if (!movie) return;
      displayMovie(movie);
      handleRelaunchCount();
    }

    /* Display */
    function displayMovie(movie) {
      document.getElementById("title").innerText = movie.title || "";
      document.getElementById("meta").innerText =
        `${movie.director || ""} · ${movie.year || ""} · ${movie.genre || ""}`;
      document.getElementById("desc").innerText = movie.description || "";

      const bgUrl = movie.background_file?.trim();

      console.log("Background URL:", bgUrl);

      if (bgUrl) {
        bgEl.style.backgroundImage = `url("${bgUrl}")`;
        bgEl.style.backgroundColor = "transparent";
      } else {
        bgEl.style.backgroundImage = "none";
        bgEl.style.backgroundColor = "#000";
      }
    }

    /* Relaunch warning */
    function handleRelaunchCount() {
      relaunchCount++;
      const step = Math.floor(relaunchCount / 5) - 1;
      document.getElementById("warning").innerText = messages[step] || "";
    }

    /* Search */
    searchInput.addEventListener("input", function () {
      const query = this.value.toLowerCase();
      suggestionsEl.innerHTML = "";

      if (!query) {
        suggestionsEl.style.display = "none";
        return;
      }

      const matches = movies.filter(m =>
        m.title.toLowerCase().includes(query)
      );

      matches.forEach(m => {
        const li = document.createElement("li");
        li.textContent = m.title;
        li.onclick = () => {
          pickMovieByTitle(m.title);
          suggestionsEl.style.display = "none";
          searchInput.value = "";
        };
        suggestionsEl.appendChild(li);
      });

      suggestionsEl.style.display = matches.length ? "block" : "none";
    });

    /* Cursor */
    const OPEN_CURSOR = "url('https://raw.githubusercontent.com/astridkzn/incredibly-strange-films/main/images/open.png') 16 16, auto";
    const CLOSE_CURSOR = "url('https://raw.githubusercontent.com/astridkzn/incredibly-strange-films/main/images/close.png') 16 16, auto";

    document.body.style.cursor = OPEN_CURSOR;
    document.addEventListener("mousedown", () => document.body.style.cursor = CLOSE_CURSOR);
    document.addEventListener("mouseup", () => document.body.style.cursor = OPEN_CURSOR);
  </script>

</body>
</html>
